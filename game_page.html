<!--
The source code of this webpage contains a game.
programmer: Jaeheon Jung
art asset designer : Jaeheon Jung
The method of the game : 
A user has to turn off the faucats that are randomely turned on and take items
to save the water.
-->
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="stylesheet" href="style1.css"/>
</head>
<body>
    <div id = "title" style="position:absolute; top:0px; left:0px; height:80px; width:375px; border:solid 1px; background-color:azure; text-align: center;font-size:20px;color:darkblue;">
        <p><b>Save Our Water!</b></p>
    </div>
    
    <div id="time" style="position:absolute; top:57px; left:150px;">time : 00</div>
    <div id="score" style="position:absolute; top:57px; left:300px;">score : 00</div>    
    <div id="base" style="position:absolute;  top:80px; left:0px; width:375px; height:507px; border: solid 1px;">
    
    <img id="blocks0" src="./game_images/stove2.gif" ontouchstart="blockFunction(event)"/>
    <img id="blocks1" src="./game_images/laundry1.gif" ontouchstart="blockFunction(event)"/>
    <img id="blocks2" src="./game_images/sesu2.gif" ontouchstart="blockFunction(event)"/>
    <img id="blocks3" src="./game_images/bottle2.gif" ontouchstart="blockFunction(event)"/>
    <img id="blocks4" src="./game_images/sink2.gif" ontouchstart="blockFunction(event)"/>

    <img id="blocks5" src="./game_images/sink2.gif" ontouchstart="blockFunction(event)"/>
    <img id="blocks6" src="./game_images/sesu2.gif" ontouchstart="blockFunction(event)"/>
    <img id="blocks7" src="./game_images/sesu2.gif" ontouchstart="blockFunction(event)"/>
    <img id="blocks8" src="./game_images/shower1.gif" ontouchstart="blockFunction(event)"/>
    <img id="blocks9" src="./game_images/hose1.gif" ontouchstart="blockFunction(event)"/>
    

    <img id="items0" class="drobby" src="./game_images/drop6.png" ontouchstart="blocksFunction(event)"/>
    <img id="items1" class="drobby" src="./game_images/drop6.png" ontouchstart="blocksFunction(event)"/>
    <img id="items2" class="drobby" src="./game_images/drop6.png" ontouchstart="blocksFunction(event)"/>

    <div id="fish" ondrop="drop(event)" ondragover="allowDrop(event)" 
         style="position:absolute;  bottom:0px; width:90px; height:200px; border: solid; background-color: azure;"> <div id="water"></div>
    </div></div>
    <br>
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>
    <script src="./js/dBAPIs.js"></script>
    <script>
        var waterLevel = 200;
        var score = 0;
        var time = 0;
        var yn = 0;
        
        if(localStorage.getItem("userKey") == "null"){
            var div1 = document.createElement("div");
            div1.setAttribute("id","gamestart");
            div1.style.position = "absolute";
            div1.style.top = "180px";
            div1.style.left = "25px";
            div1.style.width = "320px";
            div1.style.height = "200px";
            div1.style.backgroundColor = "#382F71";
            div1.style.opacity = "0.9";
            div1.style.border = "solid";
            div1.style.zIndex = "6";
            div1.style.textAlign = "center";
            div1.style.fontSize = "30px";
            div1.style.color = "azure";
            div1.innerHTML = "<br>Do you want to log in?<br><input type='button' value='yes' onclick='ynFunction1()'/><br><input type='button' value='no' onclick='ynFunction2()'/><br>";
            document.body.appendChild(div1);
        }else{
            randFunction();
        }        
        function scoreLine(){
            var tmpStr ="";
            
            var div = document.createElement("div");
            div.style.position = "absolute";
            div.style.top = "50px";
            div.style.left = "50px";
            div.style.width = "280px";
            div.style.height = "400px";
            div.style.backgroundColor = "azure";
            div.style.opacity = "0.9";
            div.style.border = "solid";
            div.style.zIndex = "5";
            tmpStr += "<table style='position:absolute; left:25px; top:25px; text-align:center;'cellspacing='20';><thead><tr><td>RANK</td><td>NAME</td><td>SCORE</td></tr></thead>"; 
            var rank = 1;
            var iter = 0;
            var arr = [];
            loadScore().forEach(function(childSnapshot) {
            var childKey = childSnapshot.key;
            var childData = childSnapshot.val();
            arr[iter++] = childData;
            for(var i = 0 ; i < arr.length; i++){
            for(var j = i+1 ; j < arr.length ; j++){
                if(arr[i]['user_score'] < arr[j]['user_score']){
                var tmp = arr[i];
                arr[i] = arr[j];
                arr[j] = tmp;
                }
            }}
            });
            for(var i = 0 ; i < arr.length ; i++){
                tmpStr += "<tr><td>" + rank++ + "</td><td>" + arr[i]['user_name'] + "</td><td>" + arr[i]['user_score'] + "</td></tr>";
            }
            tmpStr += "<tfoot><tr><input type='button' value='Restart!' onclick='location.reload()'/><input type='button' value='Main Page' onclick='ynFunction2()'/></tr></tfoot></table>";
            div.innerHTML = tmpStr;
            document.body.removeChild(document.getElementById("gameover"));
            document.body.appendChild(div);
        }
        
        
        var blockVariables = [];
        for(var i = 0 ; i<10 ; i++){
            blockVariables[i] = false;
        }
        function blockFunction(e){
            if(blockVariables[e.target.id.charAt(e.target.id.length-1)]){
            var source = e.target.id.charAt(e.target.id.length-1);
            if( 0 == source){document.getElementById("blocks0").src = "./game_images/stove2.gif";}else if( 1 == source){document.getElementById("blocks1").src = "./game_images/laundry1.gif" ;}else if( 2 == source){document.getElementById("blocks2").src = "./game_images/sesu2.gif";}else if( 3 == source){document.getElementById("blocks3").src = "./game_images/bottle2.gif";}else if( 4== source){document.getElementById("blocks4").src = "./game_images/sink2.gif";}else if( 5 == source){document.getElementById("blocks5").src = "./game_images/sink2.gif";}else if( 6 == source){document.getElementById("blocks6").src = "./game_images/sesu2.gif";}else if( 7 == source){document.getElementById("blocks7").src = "./game_images/sesu2.gif";}else if( 8 == source){document.getElementById("blocks8").src = "./game_images/shower1.gif";}else if( 9 == source){document.getElementById("blocks9").src = "./game_images/hose1.gif";}blockVariables[source] = !blockVariables[source];
            waterLevel += 1.0;
            document.getElementById("water").style.height = waterLevel + "px";
            score += 1;
            document.getElementById("score").innerHTML = "score : " + score;
            }
            return false;
        }
        function blocksFunction(e){
            e.target.style.visibility = "hidden";
            waterLevel += 10/2;
            document.getElementById("water").style.height = waterLevel + "px";
        }
        
        var truePrac = true;
        function randFunction() {
            setInterval(function(){ 
            var spawnRatio = Math.floor((Math.random() * 2) + 1);
            if(spawnRatio==1){
                var max = Math.floor((Math.random() * 2) + 1);
                for(var i = 0; i<max; i++){
                    var source = Math.floor((Math.random() * 10) + 1) - 1;
                    if(!blockVariables[source]){
                    if( 0 == source){document.getElementById("blocks0").src = "./game_images/stove2w.gif";}else if( 1 == source){document.getElementById("blocks1").src = "./game_images/laundry1w.gif" ;}else if( 2 == source){document.getElementById("blocks2").src = "./game_images/sesu2w.gif";}else if( 3 == source){document.getElementById("blocks3").src = "./game_images/bottle2w.gif";}else if( 4== source){document.getElementById("blocks4").src = "./game_images/sink2w.gif";}else if( 5 == source){document.getElementById("blocks5").src = "./game_images/sink2w.gif";}else if( 6 == source){document.getElementById("blocks6").src = "./game_images/sesu2w.gif";}else if( 7 == source){document.getElementById("blocks7").src = "./game_images/sesu2w.gif";}else if( 8 == source){document.getElementById("blocks8").src = "./game_images/shower1w.gif";}else if( 9 == source){document.getElementById("blocks9").src = "./game_images/hose1w.gif";}blockVariables[source] = !blockVariables[source];
                    }
                }
            }
            if(spawnRatio==1){
                var max = Math.floor((Math.random() * 3) + 1) - 1;
                for(var i = 0; i<max; i++){
                var source = Math.floor((Math.random() * 3) + 1) - 1;
                if(source == 0){document.getElementById("items0").style.visibility="visible";}else if(source == 1){document.getElementById("items1").style.visibility="visible";}else if(source == 2){document.getElementById("items2").style.visibility="visible";}}
            }
            time += 1;

            document.getElementById("time").innerHTML = "time : " + time;}, 1000);
            setInterval(function(){ 
            if(waterLevel > 200){
                waterLevel = 200;
            }else if ( waterLevel < 0){
                waterLevel = 2;
            }
            for(var i = 0 ; i < 10 ; i++){
                if(blockVariables[i]){
                waterLevel -= 1.0;
                var tmpStr = "";
                if(truePrac){
                if(waterLevel <= 0){
                   truePrac = false;
                    saveScore(score);
                    
                    var div1 = document.createElement("div");
                    div1.setAttribute("id","gameover");
                    div1.style.position = "absolute";
                    div1.style.top = "180px";
                    div1.style.left = "25px";
                    div1.style.width = "320px";
                    div1.style.height = "200px";
                    div1.style.backgroundColor = "#382F71";
                    div1.style.opacity = "0.9";
                    div1.style.border = "solid";
                    div1.style.zIndex = "6";
                    div1.style.textAlign = "center"; 
                    div1.style.fontSize = "30px";
                    div1.style.color = "azure";
                    div1.innerHTML = "<br>Game Over<br><input type='button' value='Restart!' onclick='location.reload()'/><br><input type='button' value='Main Page' onclick='ynFunction2()'/><br><input type='button' value='Leader Board' onclick='scoreLine()'/>";
                    document.body.appendChild(div1);
                }
                    
                document.getElementById("water").style.height = waterLevel + "px";
                }
                }
            }}, 200);
         }
        function ynFunction1(){
            window.location.href="login.html";
        }
        function ynFunction2(){
            window.location.href="index.html";
        }
    </script>
    
    
    <div style="position:absolute; top:589px; left:0px; height:80px; width:375px; border:solid 1px; background-color:#382F71;border:solid 1px;"></div>
    
    
                        
    
    
    
</body>
</html>

